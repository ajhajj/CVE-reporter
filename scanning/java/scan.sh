#!/bin/sh

CLASS_NAME="com.fasterxml.jackson.databind"
FLDR="image"
WAR_FLDR="war"

function jar_scan()
  {
    local fldr="./${1}"

    find ${fldr}/ \( -name "*.jar" -o -name "*.zip" \) | while read JAR;
      do
        # skipping symbolic links (duplicate scanning)
        if [ ! -h "${JAR}" ]; then
          CLASSES=( $(jar -tf ${JAR} | grep ${CLASS_NAME}) )
    
          if [ ${#CLASSES[@]} -gt 0 ]; then
            printf "\n"
            echo "JAR File: $(basename ${JAR})"
            echo "JAR Path: $(echo ${JAR} | sed -e 's|^.*'"${fldr}"'||' -e 's|^\(/.*/\).*|\1|')"

            for class in "${CLASSES[@]}"
              do
                if [ -n "${class}" ]; then
                  frmtClass=$(echo "${class}" | sed -e 's|/$||' -e 's/.class$//' -e 's|/|.|g') 
                  echo "Class: ${frmtClass}" 
                fi
              done
            printf "\n"
          fi
        fi 
      done
  }

function war_scan()
  {
    local fldr="./${1}"

    find ${fldr}/ -name "*.war" | while read WAR;
      do
        # skipping symbolic links (duplicate scanning)
        if [ ! -h "${WAR}" ]; then
          rm -rf ${WAR_FLDR}
          mkdir ${WAR_FLDR}
          cd ${WAR_FLDR}
          jar -xf ../${WAR}
          cd ..
          
          printf "\n"
          echo "WAR File: $(basename ${WAR})"
          echo "WAR Path: $(echo ${WAR} | sed -e 's|^'"${fldr}"'||' -e 's|^\(/.*/\).*|\1|')"
          jar_scan ${WAR_FLDR}
        fi
      done
    rm -rf ${WAR_FLDR}
  }

clear
jar_scan ${FLDR}
war_scan ${FLDR}
